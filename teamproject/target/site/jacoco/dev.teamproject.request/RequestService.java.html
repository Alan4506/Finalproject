<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>RequestService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">teamproject</a> &gt; <a href="index.source.html" class="el_package">dev.teamproject.request</a> &gt; <span class="el_source">RequestService.java</span></div><h1>RequestService.java</h1><pre class="source lang-java linenums">package dev.teamproject.request;

import dev.teamproject.common.CommonTypes;
import dev.teamproject.timeslot.TimeSlot;
import dev.teamproject.timeslot.TimeSlotService;
import dev.teamproject.user.User;
import dev.teamproject.user.UserService;
import java.util.List;
import java.util.Optional;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

/**
 * Service class for managing requests associated with time slots.
 */

@Service
public class RequestService {
  private final RequestRepo requestRepo;
  private final UserService userService;
  private final TimeSlotService tsService;

  /**
   * Constructs a RequestService with the specified dependencies.
   *
   * @param requestRepo the repository for managing requests
   * @param userService the service for managing users
   * @param tsService   the service for managing time slots
   */

  @Autowired
  public RequestService(RequestRepo requestRepo,
<span class="fc" id="L33">                        UserService userService, TimeSlotService tsService) {</span>
<span class="fc" id="L34">    this.tsService = tsService;</span>
<span class="fc" id="L35">    this.userService = userService;</span>
<span class="fc" id="L36">    this.requestRepo = requestRepo;</span>
<span class="fc" id="L37">  }</span>

  /**
   * Creates a new request.
   *
   * @param req the request to be created
   * @return the created request
   */
  public Request createRequest(Request req) {
    // Validate user exists
<span class="fc" id="L47">    User user = userService.findById(req.getUser().getUid());</span>
<span class="fc" id="L48">    req.setUser(user);</span>
<span class="fc" id="L49">    TimeSlot ts = tsService.getTimeSlotById(req.getTimeSlot().getTid());</span>
<span class="fc" id="L50">    req.setTimeSlot(ts);</span>
<span class="fc" id="L51">    return requestRepo.save(req);</span>
  }

  /**
   * Deletes a request by its time slot ID and requester ID.
   *
   * @param tid        the time slot ID
   * @param requesterId the ID of the requester
   * @throws RuntimeException if the request is not found
   */
  public void deleteRequest(int tid, int requesterId) {
<span class="fc" id="L62">    RequestId requestId = new RequestId(</span>
<span class="fc" id="L63">            tsService.getTimeSlotById(tid), userService.findById(requesterId));</span>
<span class="fc" id="L64">    Optional&lt;Request&gt; request = requestRepo.findById(requestId);</span>
    
<span class="fc bfc" id="L66" title="All 2 branches covered.">    if (request.isPresent()) {</span>
<span class="fc" id="L67">      requestRepo.deleteById(requestId);</span>
    } else {
<span class="fc" id="L69">      throw new RuntimeException(&quot;Request not found&quot;);</span>
    }
<span class="fc" id="L71">  }</span>

  /**
   * Updates the description of a request.
   *
   * @param tid             the time slot ID
   * @param requesterId     the ID of the requester
   * @param newDescription  the new description for the request
   * @return the updated request
   * @throws RuntimeException if the request is not found
   */
  public Request updateRequestDescription(int tid, int requesterId, String newDescription) {
<span class="fc" id="L83">    RequestId requestId = new RequestId(</span>
<span class="fc" id="L84">            tsService.getTimeSlotById(tid), userService.findById(requesterId));</span>
<span class="fc" id="L85">    Optional&lt;Request&gt; optionalRequest = requestRepo.findById(requestId);</span>
    
<span class="pc bpc" id="L87" title="1 of 2 branches missed.">    if (optionalRequest.isPresent()) {</span>
<span class="fc" id="L88">      Request request = optionalRequest.get();</span>
      // Update description if newDescription is not null or not empty
<span class="pc bpc" id="L90" title="2 of 4 branches missed.">      if (newDescription != null &amp;&amp; !newDescription.isEmpty()) {</span>
<span class="fc" id="L91">        request.setDescription(newDescription);</span>
      }
      
<span class="fc" id="L94">      return requestRepo.save(request);</span>
    } else {
<span class="nc" id="L96">      throw new RuntimeException(&quot;Request not found&quot;);</span>
    }
  }

  /**
   * Updates the status of a request.
   *
   * @param tid        the time slot ID
   * @param requesterId the ID of the requester
   * @param status     the new status for the request
   * @return the updated request
   * @throws RuntimeException if the request is not found
   */
  public Request updateRequestStatus(int tid, int requesterId, CommonTypes.RequestStatus status) {
<span class="fc" id="L110">    RequestId requestId = new RequestId(tsService.getTimeSlotById(tid),</span>
<span class="fc" id="L111">            userService.findById(requesterId));</span>
<span class="fc" id="L112">    Optional&lt;Request&gt; optionalRequest = requestRepo.findById(requestId);</span>
    
<span class="pc bpc" id="L114" title="1 of 2 branches missed.">    if (optionalRequest.isPresent()) {</span>
<span class="fc" id="L115">      Request request = optionalRequest.get();</span>
      // Update description if newDescription is not null or not empty
<span class="pc bpc" id="L117" title="1 of 2 branches missed.">      if (status != null) {</span>
<span class="fc" id="L118">        request.setStatus(status);</span>
      }
      
<span class="fc" id="L121">      return requestRepo.save(request);</span>
    } else {
<span class="nc" id="L123">      throw new RuntimeException(&quot;Request not found&quot;);</span>
    }
  }

  /**
   * Retrieves a request by its requester ID and time slot ID.
   *
   * @param requesterId the ID of the requester
   * @param tid        the time slot ID
   * @return the found request
   * @throws RuntimeException if the request is not found
   */
  public Request getRequestById(int requesterId, int tid) {
<span class="fc" id="L136">    RequestId requestId = new RequestId(tsService.getTimeSlotById(tid),</span>
<span class="fc" id="L137">            userService.findById(requesterId));  // Create the composite key</span>
<span class="fc" id="L138">    Optional&lt;Request&gt; optionalRequest = requestRepo.findById(requestId);</span>
    
<span class="pc bpc" id="L140" title="1 of 2 branches missed.">    if (optionalRequest.isPresent()) {</span>
<span class="fc" id="L141">      return optionalRequest.get();  // Return the found Request</span>
    } else {
<span class="nc" id="L143">      throw new RuntimeException(&quot;Request not found&quot;);  // Handle request not found</span>
    }
  }

  /**
   * Retrieves a list of requests by the requester ID.
   *
   * @param uid the ID of the user making the requests
   * @return a list of requests associated with the user
   */
  public List&lt;Request&gt; getRequestsByRequester(int uid) {
<span class="fc" id="L154">    User user = userService.findById(uid);</span>
<span class="fc" id="L155">    return requestRepo.findByUser(user);</span>
  }

  /**
   * Retrieves a list of requests associated with a specific time slot.
   *
   * @param tid the time slot ID
   * @return a list of requests for the specified time slot
   */
  public List&lt;Request&gt; getRequestsByTimeSlot(int tid) {
<span class="fc" id="L165">    TimeSlot ts = tsService.getTimeSlotById(tid);</span>
<span class="fc" id="L166">    return requestRepo.findByTimeSlot(ts);</span>
  }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>